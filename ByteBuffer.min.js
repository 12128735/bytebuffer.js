/**
 * ByteBuffer.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/ByteBuffer.js for details
 */
var ByteBuffer=function(e,t){e=typeof e!="undefined"?parseInt(e,10):ByteBuffer.DEFAULT_CAPACITY;if(e<1)e=ByteBuffer.DEFAULT_CAPACITY;this.array=arguments.length==3&&arguments[2]===true?null:new ArrayBuffer(e);this.view=this.array!=null?new DataView(this.array):null;this.offset=0;this.length=0;this.littleEndian=typeof t!="undefined"?!!t:false};ByteBuffer.DEFAULT_CAPACITY=32;ByteBuffer.LITTLE_ENDIAN=true;ByteBuffer.BIG_ENDIAN=false;ByteBuffer.allocate=function(e,t){return new ByteBuffer(e,t)};ByteBuffer.wrap=function(e,t){if(!!e["array"]){e=e["array"]}else if(!!e["buffer"]){e=e["buffer"]}if(!(e instanceof ArrayBuffer)){throw"Cannot wrap buffer of type "+typeof e}var n=new ByteBuffer(0,t,true);n.array=e;n.view=new DataView(n.array);n.offset=0;n.length=e.byteLength;return n};ByteBuffer.prototype.resize=function(e){if(this.array==null&&e>0){this.array=new ArrayBuffer(e);this.view=new DataView(this.array)}if(this.array.byteLength<e){var t=this.array;var n=new Uint8Array(t);var r=new ArrayBuffer(e);var i=new Uint8Array(r);i.set(n);this.array=r;this.view=new DataView(r);return true}return false};ByteBuffer.prototype.slice=function(e,t){if(this.array==null){throw this+" cannot be sliced: Already destroyed"}if(t<=e){throw this+" cannot be sliced: End ("+t+") is less than begin ("+e+")"}if(e<0||e>this.array.byteLength||t<1||t>this.array.byteLength){throw this+" cannot be sliced: Index out of bounds (0-"+this.array.byteLength+" -> "+e+"-"+t+")"}var n=this.clone();n.offset=e;n.length=t;return n};ByteBuffer.prototype.sliceAndCompact=function(e,t){return ByteBuffer.wrap(this.slice(e,t).toArrayBuffer(true))};ByteBuffer.prototype.ensureCapacity=function(e){if(this.array==null){return this.resize(e)}if(this.array.byteLength<e)this.resize(this.array.byteLength*2>=e?this.array.byteLength*2:e)};ByteBuffer.prototype.flip=function(){if(this.array==null){throw this+" cannot be flipped: Already destroyed"}this.length=this.offset;this.offset=0;return this};ByteBuffer.prototype.reset=function(){this.offset=0;this.length=0;return this};ByteBuffer.prototype.clone=function(){var e=new ByteBuffer(-1,this.littleEndian,true);e.array=this.array;e.view=this.view;e.offset=this.offset;e.length=this.length;return e};ByteBuffer.prototype.copy=function(){var e=new ByteBuffer(this.array.byteLength,this.littleEndian);var t=new Uint8Array(this.array);var n=new Uint8Array(e.array);n.set(t);e.offset=this.offset;e.length=this.length;return e};ByteBuffer.prototype.compact=function(){if(this.array==null){throw this+" cannot be compacted: Already destroyed"}var e;if(this.offset>this.length){this.flip()}if(this.offset==this.length){throw this+" cannot be compacted: Offset ("+this.offset+") is equal to its length ("+this.length+")"}if(this.offset==0&&this.length==this.array.byteLength){return this}var t=new Uint8Array(this.array);var n=new ArrayBuffer(this.length-this.offset);var r=new Uint8Array(n);r.set(t.subarray(this.offset,this.length));this.array=n;this.offset=0;this.length=this.array.byteLength;return this};ByteBuffer.prototype.destroy=function(){if(this.array==null)return;this.array=null;this.view=null;this.offset=0;this.length=0};ByteBuffer.prototype.writeInt8=function(e,t){t=typeof t!="undefined"?t:(this.offset+=1)-1;this.ensureCapacity(t+1);this.view.setInt8(t,e,this.littleEndian);return this};ByteBuffer.prototype.readInt8=function(e){e=typeof e!="undefined"?e:(this.offset+=1)-1;return this.view.getUint8(e,this.littleEndian)};ByteBuffer.prototype.writeByte=ByteBuffer.prototype.writeInt8;ByteBuffer.prototype.readByte=ByteBuffer.prototype.readInt8;ByteBuffer.prototype.writeUint8=function(e,t){t=typeof t!="undefined"?t:(this.offset+=1)-1;this.ensureCapacity(t+1);this.view.setUint8(t,e,this.littleEndian);return this};ByteBuffer.prototype.readUint8=function(e){e=typeof e!="undefined"?e:(this.offset+=1)-1;return this.view.getUint8(e,this.littleEndian)};ByteBuffer.prototype.writeInt16=function(e,t){t=typeof t!="undefined"?t:(this.offset+=2)-2;this.ensureCapacity(t+2);this.view.setInt16(t,e,this.littleEndian);return this};ByteBuffer.prototype.readInt16=function(e){e=typeof e!="undefined"?e:(this.offset+=2)-2;return this.view.getInt16(e,this.littleEndian)};ByteBuffer.prototype.writeShort=ByteBuffer.prototype.writeInt16;ByteBuffer.prototype.readShort=ByteBuffer.prototype.readInt16;ByteBuffer.prototype.writeUint16=function(e,t){t=typeof t!="undefined"?t:(this.offset+=2)-2;this.ensureCapacity(t+2);this.view.setUint16(t,e,this.littleEndian);return this};ByteBuffer.prototype.readUint16=function(e){e=typeof e!="undefined"?e:(this.offset+=2)-2;return this.view.getUint16(e,this.littleEndian)};ByteBuffer.prototype.writeInt32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setInt32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readInt32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getInt32(e,this.littleEndian)};ByteBuffer.prototype.writeInt=ByteBuffer.prototype.writeInt32;ByteBuffer.prototype.readInt=ByteBuffer.prototype.readInt32;ByteBuffer.prototype.writeUint32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setUint32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readUint32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getUint32(e,this.littleEndian)};ByteBuffer.prototype.writeFloat32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setFloat32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readFloat32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getFloat32(e,this.littleEndian)};ByteBuffer.prototype.writeFloat=ByteBuffer.prototype.writeFloat32;ByteBuffer.prototype.readFloat=ByteBuffer.prototype.readFloat32;ByteBuffer.prototype.writeFloat64=function(e,t){t=typeof t!="undefined"?t:(this.offset+=8)-8;this.ensureCapacity(t+8);this.view.setFloat32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readFloat64=function(e){e=typeof e!="undefined"?e:(this.offset+=8)-8;return this.view.getFloat32(e,this.littleEndian)};ByteBuffer.prototype.writeDouble=ByteBuffer.prototype.writeFloat64;ByteBuffer.prototype.readDouble=ByteBuffer.prototype.readFloat64;ByteBuffer.prototype.writeUTF8String=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;var r=t;this.ensureCapacity(t+e.length*6);for(var i=0;i<e.length;i++){t+=ByteBuffer.encodeUTF8Char(e.charCodeAt(i),this,t)}if(n){this.offset=t;return this}else{return t-r}};ByteBuffer.prototype.readUTF8String=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;var r,i="",s=t;for(var o=0;o<e;o++){r=ByteBuffer.decodeUTF8Char(this,t);t+=r["length"];i+=String.fromCharCode(r["char"])}if(n){this.offset=t;return i}else{return{string:i,length:t-s}}};ByteBuffer.prototype.writeLString=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;this.writeUint32(e.length,t);var r=this.writeUTF8String(e,t+4);if(n){this.offset+=4+r;return this}else{return 4+r}};ByteBuffer.prototype.readLString=function(e){var t=typeof e=="undefined";e=typeof e!="undefined"?e:this.offset;var n=this.readUint32(e);var r=this.readUTF8String(n,e+4);if(t){this.offset+=4+r["length"];return r["string"]}else{return{string:r["string"],length:4+r["length"]}}};ByteBuffer.prototype.writeCString=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;var r=this.writeUTF8String(e,t);this.writeUint8(e,t+r);if(n){this.offset+=r+1;return this}else{return r+1}};ByteBuffer.prototype.readCString=function(e){var t=typeof e=="undefined";e=typeof e!="undefined"?e:this.offset;var n,r="",i=e;do{n=ByteBuffer.decodeUTF8Char(this,e);e+=n["length"];if(n["char"]!=0)r+=String.fromCharCode(n["char"])}while(n["char"]!=0);if(t){this.offset=e;return r}else{return{string:r,length:e-i}}};ByteBuffer.prototype.writeJSON=function(e,t,n){n=n||JSON.stringify.bind(JSON);return this.writeUTF8String(n(e),t)};ByteBuffer.prototype.readJSON=function(e,t){t=t||JSON.parse.bind(JSON);var n=this.readUTF8String(e);if(typeof n=="string"){return t(n)}else{return{data:t(n["string"]),length:n["length"]}}};ByteBuffer.LINE="--------------------------------------------------";ByteBuffer.prototype.printDebug=function(){console.log(this.toString()+"\n"+ByteBuffer.LINE);console.log(this.toHex()+"\n")};ByteBuffer.prototype.toHex=function(e){if(this.array==null)return"DESTROYED";e=typeof e!="undefined"?parseInt(e,10):16;if(e<1)e=16;var t="",n=new Uint8Array(this.array);for(var r=0;r<this.array.byteLength;r++){var i=n[r];i=i.toString(16).toUpperCase();if(i.length<2)i="0"+i;if(r>0&&r%e==0){t+="\n"}if(r==this.offset&&r==this.length){t+="|"}else if(r==this.offset){t+="<"}else if(r==this.length){t+=">"}else{t+=" "}t+=i}if(this.length==this.array.byteLength){t+=">"}else if(this.offset==this.array.byteLength){t+="<"}return t};ByteBuffer.prototype.toString=function(){if(this.array==null){return"ByteBuffer(DESTROYED)"}return"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")"};ByteBuffer.prototype.toArrayBuffer=function(e){var t=this.clone();if(t.offset>t.length){t.flip()}var n=false;if(t.offset>0||t.length<t.array.byteLength){t.compact();n=true}return e&&!n?t.copy().array:t.array};ByteBuffer.decodeUTF8Char=function(e,t){var n=e.readUint8(t),r,i,s,o,u,a=t,f;if((n&128)==0){f=n;t+=1}else if((n&224)==192){r=e.readUint8(t+1);f=(n&31)<<6|r&63;t+=2}else if((n&240)==224){r=e.readUint8(t+1);i=e.readUint8(t+2);f=(n&15)<<12|(r&63)<<6|i&63;t+=3}else if((n&248)==240){r=e.readUint8(t+1);i=e.readUint8(t+2);s=e.readUint8(t+3);f=(n&7)<<18|(r&63)<<12|(i&63)<<6|s&63;t+=4}else if((n&252)==248){r=e.readUint8(t+1);i=e.readUint8(t+2);s=e.readUint8(t+3);o=e.readUint8(t+4);f=(n&3)<<24|(r&63)<<18|(i&63)<<12|(s&63)<<6|o&63;t+=5}else if((n&254)==252){r=e.readUint8(t+1);i=e.readUint8(t+2);s=e.readUint8(t+3);o=e.readUint8(t+4);u=e.readUint8(t+5);f=(n&1)<<30|(r&63)<<24|(i&63)<<18|(s&63)<<12|(o&63)<<6|u&63;t+=6}else{throw"Invalid byte at offset "+t+": 0x"+n.toString(16)}return{"char":f,length:t-a}};ByteBuffer.encodeUTF8Char=function(e,t,n){var r=e,i=n;if(r<128){t.writeUint8(r&127,n);n+=1}else if(r<2048){t.writeUint8(r>>6&31|192,n).writeUint8(r&63|128,n+1);n+=2}else if(r<65536){t.writeUint8(r>>12&15|224,n).writeUint8(r>>6&63|128,n+1).writeUint8(r&63|128,n+2);n+=3}else if(r<2097152){t.writeUint8(r>>18&7|240,n).writeUint8(r>>12&63|128,n+1).writeUint8(r>>6&63|128,n+2).writeUint8(r&63|128,n+3);n+=4}else if(r<67108864){t.writeUint8(r>>24&3|248,n).writeUint8(r>>18&63|128,n+1).writeUint8(r>>12&63|128,n+2).writeUint8(r>>6&63|128,n+3).writeUint8(r&63|128,n+4);n+=5}else{t.writeUint8(r>>30&1|252,n).writeUint8(r>>24&63|128,n+1).writeUint8(r>>18&63|128,n+2).writeUint8(r>>12&63|128,n+3).writeUint8(r>>6&63|128,n+4).writeUint8(r&63|128,n+5);n+=6}return n-i};if(typeof module!="undefined"&&module["exports"]){module["exports"]=ByteBuffer}else if(typeof require!="undefined"&&typeof define!="undefined"){define("dcodeIO/ByteBuffer/ByteBuffer",[],function(){return ByteBuffer})}else if(typeof window!="undefined"){if(typeof window["dcodeIO"]=="undefined"){window["dcodeIO"]={}}window["dcodeIO"]["ByteBuffer"]=ByteBuffer;delete window["ByteBuffer"]}

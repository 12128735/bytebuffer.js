/**
 * ByteBuffer.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/ByteBuffer.js for details
 */
var ByteBuffer=function(e,t){e=typeof e!="undefined"?parseInt(e,10):ByteBuffer.DEFAULT_CAPACITY;if(e<1)e=ByteBuffer.DEFAULT_CAPACITY;this.array=arguments.length==3&&arguments[2]===true?null:new ArrayBuffer(e);this.view=this.array!=null?new DataView(this.array):null;this.offset=0;this.length=0;this.littleEndian=typeof t!="undefined"?!!t:false};ByteBuffer.DEFAULT_CAPACITY=32;ByteBuffer.allocate=function(e,t){return new ByteBuffer(e,t)};ByteBuffer.wrap=function(e,t){var n=new ByteBuffer(0,t,true);n.array=e;n.view=new DataView(n.array);n.offset=0;n.length=e.byteLength;return n};ByteBuffer.prototype.resize=function(e){if(this.array==null&&e>0){this.array=new ArrayBuffer(e);this.view=new DataView(this.array)}if(this.array.byteLength<e){var t=this.array;var n=new Uint8Array(t);var r=new ArrayBuffer(e);var i=new Uint8Array(r);i.set(n);this.array=r;this.view=new DataView(r);return true}return false};ByteBuffer.prototype.ensureCapacity=function(e){if(this.array==null){return this.resize(e)}if(this.array.byteLength<e)this.resize(this.array.byteLength*2>=e?this.array.byteLength*2:e)};ByteBuffer.prototype.flip=function(){if(this.array==null){throw this+" cannot be flipped: Already destroyed"}this.length=this.offset;this.offset=0;return this};ByteBuffer.prototype.reset=function(){this.offset=0;this.length=0;return this};ByteBuffer.prototype.clone=function(){var e=new ByteBuffer(-1,this.littleEndian,true);e.array=this.array;e.view=this.view;e.offset=this.offset;e.length=this.length;return e};ByteBuffer.prototype.compact=function(){if(this.array==null){throw this+" cannot be compacted: Already destroyed"}var e;if(this.offset>this.length){e=this.clone().flip()}else{e=this}var t=e.array;var n=new Uint8Array(t);var r=new ArrayBuffer(e.length-e.offset);var i=new Uint8Array(r);i.set(n.subarray(e.offset,e.length));return r};ByteBuffer.prototype.destroy=function(){if(this.array==null)return;this.array=null;this.view=null;this.offset=0;this.length=0};ByteBuffer.prototype.writeInt8=function(e,t){t=typeof t!="undefined"?t:(this.offset+=1)-1;this.ensureCapacity(t+1);this.view.setInt8(t,e,this.littleEndian);return this};ByteBuffer.prototype.readInt8=function(e){e=typeof e!="undefined"?e:(this.offset+=1)-1;return this.view.getUint8(e,this.littleEndian)};ByteBuffer.prototype.writeByte=ByteBuffer.prototype.writeInt8;ByteBuffer.prototype.readByte=ByteBuffer.prototype.readInt8;ByteBuffer.prototype.writeUint8=function(e,t){t=typeof t!="undefined"?t:(this.offset+=1)-1;this.ensureCapacity(t+1);this.view.setUint8(t,e,this.littleEndian);return this};ByteBuffer.prototype.readUint8=function(e){e=typeof e!="undefined"?e:(this.offset+=1)-1;return this.view.getUint8(e,this.littleEndian)};ByteBuffer.prototype.writeInt16=function(e,t){t=typeof t!="undefined"?t:(this.offset+=2)-2;this.ensureCapacity(t+2);this.view.setInt16(t,e,this.littleEndian);return this};ByteBuffer.prototype.readInt16=function(e){e=typeof e!="undefined"?e:(this.offset+=2)-2;return this.view.getInt16(e,this.littleEndian)};ByteBuffer.prototype.writeShort=ByteBuffer.prototype.writeInt16;ByteBuffer.prototype.readShort=ByteBuffer.prototype.readInt16;ByteBuffer.prototype.writeUint16=function(e,t){t=typeof t!="undefined"?t:(this.offset+=2)-2;this.ensureCapacity(t+2);this.view.setUint16(t,e,this.littleEndian);return this};ByteBuffer.prototype.readUint16=function(e){e=typeof e!="undefined"?e:(this.offset+=2)-2;return this.view.getUint16(e,this.littleEndian)};ByteBuffer.prototype.writeInt32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setInt32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readInt32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getInt32(e,this.littleEndian)};ByteBuffer.prototype.writeInt=ByteBuffer.prototype.writeInt32;ByteBuffer.prototype.readInt=ByteBuffer.prototype.readInt32;ByteBuffer.prototype.writeUint32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setUint32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readUint32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getUint32(e,this.littleEndian)};ByteBuffer.prototype.writeFloat32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setFloat32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readFloat32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getFloat32(e,this.littleEndian)};ByteBuffer.prototype.writeFloat=ByteBuffer.prototype.writeFloat32;ByteBuffer.prototype.readFloat=ByteBuffer.prototype.readFloat32;ByteBuffer.prototype.writeFloat64=function(e,t){t=typeof t!="undefined"?t:(this.offset+=8)-8;this.ensureCapacity(t+8);this.view.setFloat32(t,e,this.littleEndian);return this};ByteBuffer.prototype.readFloat64=function(e){e=typeof e!="undefined"?e:(this.offset+=8)-8;return this.view.getFloat32(e,this.littleEndian)};ByteBuffer.prototype.writeDouble=ByteBuffer.prototype.writeFloat64;ByteBuffer.prototype.readDouble=ByteBuffer.prototype.readFloat64;ByteBuffer.prototype.writeUTF8String=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;this.ensureCapacity(t+4+e.length*6);this.writeUint32(e.length,t);var r=ByteBuffer.encodeUTF8(e,this,t+4);if(n){this.offset+=4+r;return this}else{return 4+r}};ByteBuffer.prototype.readUTF8String=function(e){var t=typeof e=="undefined";e=typeof e!="undefined"?e:this.offset;var n=this.readUint32(e);var r=ByteBuffer.decodeUTF8(this,e+4,n);if(t){this.offset+=4+r["length"];return r["string"]}else{return r}};ByteBuffer.prototype.writeString=ByteBuffer.prototype.writeUTF8String;ByteBuffer.prototype.readString=ByteBuffer.prototype.readUTF8String;ByteBuffer.prototype.writeJSON=function(e,t,n){n=n||JSON.stringify.bind(JSON);return this.writeUTF8String(n(e),t)};ByteBuffer.prototype.readJSON=function(e,t){t=t||JSON.parse.bind(JSON);var n=this.readUTF8String(e);if(typeof n=="string"){return t(n)}else{return{data:t(n["string"]),length:n["length"]}}};ByteBuffer.LINE="--------------------------------------------------";ByteBuffer.prototype.printDebug=function(){console.log(this.toString()+"\n"+ByteBuffer.LINE);if(this.array!=null){var e=new Uint8Array(this.array);var t="";for(var n=0;n<this.array.byteLength;n++){var r=e[n];r=r.toString(16).toUpperCase();if(r.length<2)r="0"+r;if(n>0&&n%16==0){t+="\n"}if(n==this.offset&&n==this.length){t+="|"}else if(n==this.offset){t+="<"}else if(n==this.length){t+=">"}else{t+=" "}t+=r}if(this.length==this.array.byteLength){t+=">"}else if(this.offset==this.array.byteLength){t+="<"}console.log(t+"\n")}};ByteBuffer.prototype.toString=function(){if(this.array==null){return"ByteBuffer(DESTROYED)"}return"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")"};ByteBuffer.decodeUTF8=function(e,t,n){t=typeof t!="undefined"?t:e.offset;n=typeof n!="undefined"?n:-1;var r="";var i,s,o,u,a,f,l=0,c=t;while(t<e.length&&(n==-1||l<n)){i=e.readUint8(t);if((i&128)==0){r+=String.fromCharCode(i);t+=1;l++}else if((i&224)==192){s=e.readUint8(t+1);r+=String.fromCharCode((i&31)<<6|s&63);t+=2;l++}else if((i&240)==224){s=e.readUint8(t+1);o=e.readUint8(t+2);r+=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63);t+=3;l++}else if((i&248)==240){s=e.readUint8(t+1);o=e.readUint8(t+2);a=e.readUint8(t+3);r+=String.fromCharCode((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63);t+=4;l++}else if((i&252)==248){s=e.readUint8(t+1);o=e.readUint8(t+2);a=e.readUint8(t+3);u=e.readUint8(t+4);r+=String.fromCharCode((i&3)<<24|(s&63)<<18|(o&63)<<12|(a&63)<<6|u&63);t+=5;l++}else if((i&254)==252){s=e.readUint8(t+1);o=e.readUint8(t+2);a=e.readUint8(t+3);u=e.readUint8(t+4);f=e.readUint8(t+5);r+=String.fromCharCode((i&1)<<30|(s&63)<<24|(o&63)<<18|(a&63)<<12|(u&63)<<6|f&63);t+=6;l++}else{throw"Invalid byte at offset "+t+": 0x"+i.toString(16)}}return{string:r,length:t-c}};ByteBuffer.encodeUTF8=function(e,t,n){n=typeof n!="undefined"?n:t.offset;var r=n;for(var i=0;i<e.length;i++){var s=e.charCodeAt(i);if(s<128){t.writeUint8(s&127,n);n+=1}else if(s<2048){t.writeUint8(s>>6&31|192,n).writeUint8(s&63|128,n+1);n+=2}else if(s<65536){t.writeUint8(s>>12&15|224,n).writeUint8(s>>6&63|128,n+1).writeUint8(s&63|128,n+2);n+=3}else if(s<2097152){t.writeUint8(s>>18&7|240,n).writeUint8(s>>12&63|128,n+1).writeUint8(s>>6&63|128,n+2).writeUint8(s&63|128,n+3);n+=4}else if(s<67108864){t.writeUint8(s>>24&3|248,n).writeUint8(s>>18&63|128,n+1).writeUint8(s>>12&63|128,n+2).writeUint8(s>>6&63|128,n+3).writeUint8(s&63|128,n+4);n+=5}else{t.writeUint8(s>>30&1|252,n).writeUint8(s>>24&63|128,n+1).writeUint8(s>>18&63|128,n+2).writeUint8(s>>12&63|128,n+3).writeUint8(s>>6&63|128,n+4).writeUint8(s&63|128,n+5);n+=6}}return n-r};if(typeof module!="undefined"&&module["exports"]){module["exports"]=ByteBuffer}else if(typeof require!="undefined"&&typeof define!="undefined"){define("dcodeIO/ByteBuffer/ByteBuffer",[],function(){return ByteBuffer})}else if(typeof window!="undefined"){if(typeof window["dcodeIO"]=="undefined"){window["dcodeIO"]={}}window["dcodeIO"]["ByteBuffer"]=ByteBuffer;delete window["ByteBuffer"]}

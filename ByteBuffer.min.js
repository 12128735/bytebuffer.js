/*
 ByteBuffer.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ByteBuffer.js for details
*/
function d(a){throw a;}var j=!0,k=null,l=new Int32Array(1),m=new Uint32Array(1);function n(a,b){a="undefined"!=typeof a?parseInt(a,10):n.DEFAULT_CAPACITY;1>a&&(a=n.DEFAULT_CAPACITY);this.array=3==arguments.length&&arguments[2]===j?k:new ArrayBuffer(a);this.view=this.array!=k?new DataView(this.array):k;this.length=this.offset=0;this.littleEndian="undefined"!=typeof b?!!b:!1}n.DEFAULT_CAPACITY=32;n.LITTLE_ENDIAN=j;n.BIG_ENDIAN=!1;n.allocate=function(a,b){return new n(a,b)};
n.wrap=function(a,b){if("string"==typeof a)return(new n).writeUTF8String(a).flip();a.array?a=a.array:a.buffer&&(a=a.buffer);a instanceof ArrayBuffer||d("Cannot wrap buffer of type "+typeof a);var c=new n(0,b,j);c.array=a;c.view=new DataView(c.array);c.offset=0;c.length=a.byteLength;return c};
n.prototype.resize=function(a){this.array==k&&0<a&&(this.array=new ArrayBuffer(a),this.view=new DataView(this.array));if(this.array.byteLength<a){var b=new Uint8Array(this.array);a=new ArrayBuffer(a);(new Uint8Array(a)).set(b);this.array=a;this.view=new DataView(a);return j}return!1};
n.prototype.slice=function(a,b){this.array==k&&d(this+" cannot be sliced: Already destroyed");b<=a&&d(this+" cannot be sliced: End ("+b+") is less than begin ("+a+")");(0>a||a>this.array.byteLength||1>b||b>this.array.byteLength)&&d(this+" cannot be sliced: Index out of bounds (0-"+this.array.byteLength+" -> "+a+"-"+b+")");var c=this.clone();c.offset=a;c.length=b;return c};n.prototype.sliceAndCompact=function(a,b){return n.wrap(this.slice(a,b).toArrayBuffer(j))};
n.prototype.ensureCapacity=function(a){return this.array==k?this.resize(a):this.array.byteLength<a?this.resize(2*this.array.byteLength>=a?2*this.array.byteLength:a):!1};n.prototype.flip=function(){this.array==k&&d(this+" cannot be flipped: Already destroyed");this.length=this.offset;this.offset=0;return this};n.prototype.reset=function(){this.length=this.offset=0;return this};
n.prototype.clone=function(){var a=new n(-1,this.littleEndian,j);a.array=this.array;a.view=this.view;a.offset=this.offset;a.length=this.length;return a};n.prototype.copy=function(){var a=new n(this.array.byteLength,this.littleEndian),b=new Uint8Array(this.array);(new Uint8Array(a.array)).set(b);a.offset=this.offset;a.length=this.length;return a};n.prototype.remaining=function(){return this.length-this.offset};n.prototype.capacity=function(){return this.array!=k?this.array.byteLength:0};
n.prototype.compact=function(){this.array==k&&d(this+" cannot be compacted: Already destroyed");this.offset>this.length&&this.flip();this.offset==this.length&&d(this+" cannot be compacted: Offset ("+this.offset+") is equal to its length ("+this.length+")");if(0==this.offset&&this.length==this.array.byteLength)return this;var a=new Uint8Array(this.array),b=new ArrayBuffer(this.length-this.offset);(new Uint8Array(b)).set(a.subarray(this.offset,this.length));this.array=b;this.offset=0;this.length=this.array.byteLength;
return this};n.prototype.destroy=function(){if(this.array!=k)return this.view=this.array=k,this.length=this.offset=0,this};n.prototype.reverse=function(){this.array==k&&d(this+" cannot be reversed: Already destroyed");Array.prototype.reverse.call(new Uint8Array(this.array));var a=this.offset;this.offset=this.array.byteLength-this.length;this.length=this.array.byteLength-a;return this};
n.prototype.append=function(a,b){a.array==k&&d(a+" cannot be appended to "+this+": Already destroyed");var c=a.length-a.offset;if(0==c)return this;0>c&&(a=a.clone().flip(),c=a.length-a.offset);b="undefined"!=typeof b?b:(this.offset+=c)-c;this.ensureCapacity(b+c);c=new Uint8Array(a.array);(new Uint8Array(this.array)).set(c.subarray(a.offset,a.length),b);return this};
n.prototype.prepend=function(a,b){a.array==k&&d(a+" cannot be prepended to "+this+": Already destroyed");var c=a.length-a.offset;if(0==c)return this;0>c&&(a=a.clone().flip(),c=a.length-a.offset);var e="undefined"==typeof b;b="undefined"!=typeof b?b:this.offset;var f=c-b;0<f?(this.ensureCapacity(this.length+f),this.append(this,c),this.offset+=f,this.length+=f,this.append(a,0)):this.append(a,b-c);e&&(this.offset-=c);return this};
n.prototype.writeInt8=function(a,b){b="undefined"!=typeof b?b:(this.offset+=1)-1;this.ensureCapacity(b+1);this.view.setInt8(b,a,this.littleEndian);return this};n.prototype.readInt8=function(a){a="undefined"!=typeof a?a:(this.offset+=1)-1;return this.view.getInt8(a,this.littleEndian)};n.prototype.writeByte=n.prototype.writeInt8;n.prototype.readByte=n.prototype.readInt8;
n.prototype.writeUint8=function(a,b){b="undefined"!=typeof b?b:(this.offset+=1)-1;this.ensureCapacity(b+1);this.view.setUint8(b,a,this.littleEndian);return this};n.prototype.readUint8=function(a){a="undefined"!=typeof a?a:(this.offset+=1)-1;return this.view.getUint8(a,this.littleEndian)};n.prototype.writeInt16=function(a,b){b="undefined"!=typeof b?b:(this.offset+=2)-2;this.ensureCapacity(b+2);this.view.setInt16(b,a,this.littleEndian);return this};
n.prototype.readInt16=function(a){a="undefined"!=typeof a?a:(this.offset+=2)-2;return this.view.getInt16(a,this.littleEndian)};n.prototype.writeShort=n.prototype.writeInt16;n.prototype.readShort=n.prototype.readInt16;n.prototype.writeUint16=function(a,b){b="undefined"!=typeof b?b:(this.offset+=2)-2;this.ensureCapacity(b+2);this.view.setUint16(b,a,this.littleEndian);return this};n.prototype.readUint16=function(a){a="undefined"!=typeof a?a:(this.offset+=2)-2;return this.view.getUint16(a,this.littleEndian)};
n.prototype.writeInt32=function(a,b){b="undefined"!=typeof b?b:(this.offset+=4)-4;this.ensureCapacity(b+4);this.view.setInt32(b,a,this.littleEndian);return this};n.prototype.readInt32=function(a){a="undefined"!=typeof a?a:(this.offset+=4)-4;return this.view.getInt32(a,this.littleEndian)};n.prototype.writeInt=n.prototype.writeInt32;n.prototype.readInt=n.prototype.readInt32;
n.prototype.writeUint32=function(a,b){b="undefined"!=typeof b?b:(this.offset+=4)-4;this.ensureCapacity(b+4);this.view.setUint32(b,a,this.littleEndian);return this};n.prototype.readUint32=function(a){a="undefined"!=typeof a?a:(this.offset+=4)-4;return this.view.getUint32(a,this.littleEndian)};n.prototype.writeFloat32=function(a,b){b="undefined"!=typeof b?b:(this.offset+=4)-4;this.ensureCapacity(b+4);this.view.setFloat32(b,a,this.littleEndian);return this};
n.prototype.readFloat32=function(a){a="undefined"!=typeof a?a:(this.offset+=4)-4;return this.view.getFloat32(a,this.littleEndian)};n.prototype.writeFloat=n.prototype.writeFloat32;n.prototype.readFloat=n.prototype.readFloat32;n.prototype.writeFloat64=function(a,b){b="undefined"!=typeof b?b:(this.offset+=8)-8;this.ensureCapacity(b+8);this.view.setFloat64(b,a,this.littleEndian);return this};
n.prototype.readFloat64=function(a){a="undefined"!=typeof a?a:(this.offset+=8)-8;return this.view.getFloat64(a,this.littleEndian)};n.prototype.writeDouble=n.prototype.writeFloat64;n.prototype.readDouble=n.prototype.readFloat64;n.prototype.writeLong=n.prototype.writeFloat64;n.prototype.readLong=function(a){return Math.round(this.readFloat64(a))};n.a=5;
n.prototype.writeVarint32=function(a,b){var c="undefined"==typeof b;b="undefined"!=typeof b?b:this.offset;m[0]=a;this.ensureCapacity(b+n.calculateVarint32(a=m[0]));var e=new Uint8Array(this.array),f=0;e[b]=a|128;128<=a?(e[b+1]=a>>7|128,16384<=a?(e[b+2]=a>>14|128,2097152<=a?(e[b+3]=a>>21|128,268435456<=a?(e[b+4]=a>>28&127,f=5):(e[b+3]&=127,f=4)):(e[b+2]&=127,f=3)):(e[b+1]&=127,f=2)):(e[b]&=127,f=1);return c?(this.offset+=f,this):f};
n.prototype.readVarint32=function(a){var b="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;var c=new Uint8Array(this.array),e=0,f;m[0]=0;do e==n.a&&d("Cannot read Varint32 from "+this+"@"+a+": Number of bytes is larger than "+n.a),f=c[a+e],m[0]|=(f&127)<<7*e,++e;while(f&128);l[0]=m[0];return b?(this.offset+=e,l[0]):{value:l[0],length:e}};n.prototype.writeZigZagVarint32=function(a,b){return this.writeVarint32(n.zigZagEncode32(a),b)};
n.prototype.readZigZagVarint32=function(a){a=this.readVarint32(a);return"object"==typeof a?(a.value=n.zigZagDecode32(a.value),a):n.zigZagDecode32(a)};n.prototype.writeVarint=n.prototype.writeVarint32;n.prototype.readVarint=n.prototype.readVarint32;n.calculateVarint32=function(a){return 128>a?1:16384>a?2:2097152>a?3:268435456>a?4:5};n.zigZagEncode32=function(a){l[0]=a;return 0<=(a=l[0])?2*a:2*-a-1};n.zigZagDecode32=function(a){m[0]=a;return 0==((a=m[0])&1)?a/2:-(a+1)/2};
n.prototype.writeUTF8String=function(a,b){var c="undefined"==typeof b,e=b="undefined"!=typeof b?b:this.offset,f=0,g;for(g=0;g<a.length;g++)f+=n.calculateUTF8Char(a.charCodeAt(g));this.ensureCapacity(b+f);for(g=0;g<a.length;g++)b+=n.encodeUTF8Char(a.charCodeAt(g),this,b);return c?(this.offset=b,this):b-e};
n.prototype.readUTF8String=function(a,b){var c="undefined"==typeof b;b="undefined"!=typeof b?b:this.offset;for(var e,f="",g=b,h=0;h<a;h++)e=n.decodeUTF8Char(this,b),b+=e.length,f+=String.fromCharCode(e["char"]);return c?(this.offset=b,f):{string:f,length:b-g}};n.prototype.writeLString=function(a,b){var c="undefined"==typeof b;b="undefined"!=typeof b?b:this.offset;var e=n.encodeUTF8Char(a.length,this,b),e=e+this.writeUTF8String(a,b+e);return c?(this.offset+=e,this):e};
n.prototype.readLString=function(a){var b="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;var c=n.decodeUTF8Char(this,a);a=this.readUTF8String(c["char"],a+c.length);return b?(this.offset+=c.length+a.length,a.string):{string:a.string,length:c.length+a.length}};n.prototype.writeVString=function(a,b){var c="undefined"==typeof b;b="undefined"!=typeof b?b:this.offset;var e=this.writeVarint32(a.length,b),e=e+this.writeUTF8String(a,b+e);return c?(this.offset+=e,this):e};
n.prototype.readVString=function(a){var b="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;var c=this.readVarint32(a);a=this.readUTF8String(c.value,a+c.length);return b?(this.offset+=c.length+a.length,a.string):{string:a.string,length:c.length+a.length}};n.prototype.writeCString=function(a,b){var c="undefined"==typeof b;b="undefined"!=typeof b?b:this.offset;var e=this.writeUTF8String(a,b);this.writeUint8(0,b+e);return c?(this.offset+=e+1,this):e+1};
n.prototype.readCString=function(a){var b="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;var c,e="",f=a;do c=n.decodeUTF8Char(this,a),a+=c.length,0!=c["char"]&&(e+=String.fromCharCode(c["char"]));while(0!=c["char"]);return b?(this.offset=a,e):{string:e,length:a-f}};n.prototype.writeJSON=function(a,b,c){c=c||JSON.stringify;return this.writeLString(c(a),b)};n.prototype.readJSON=function(a,b){b=b||JSON.parse;var c=this.readLString(a);return"string"==typeof c?b(c):{data:b(c.string),length:c.length}};
n.prototype.printDebug=function(a){for(var b=(this.array!=k?"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")":"ByteBuffer(DESTROYED)")+"\n-------------------------------------------------------------------\n",c=this.toHex(16,j),e=this.toASCII(16,j),f=0;f<c.length;f++)b+=c[f]+"  "+e[f]+"\n";if(a===j)return b;"function"==typeof a?a(b):console.log(b)};
n.prototype.toHex=function(a,b){if(this.array==k)return"DESTROYED";b=!!b;a="undefined"!=typeof a?parseInt(a,10):16;1>a&&(a=16);for(var c="",e=[],f=new Uint8Array(this.array),c=0==this.offset&&0==this.length?c+"|":0==this.length?c+">":0==this.offset?c+"<":c+" ",g=0;g<this.array.byteLength;g++){0<g&&0==g%a&&(e.push(c),c=" ");var h=f[g],h=h.toString(16).toUpperCase();2>h.length&&(h="0"+h);c+=h;c=g+1==this.offset&&g+1==this.length?c+"|":g+1==this.offset?c+"<":g+1==this.length?c+">":c+" "}if(b)for(;c.length<
3*a+1;)c+="   ";e.push(c);return b?e:e.join("\n")};n.prototype.toASCII=function(a,b){if(this.array==k)return"";b=!!b;a="undefined"!=typeof a?parseInt(a,10):16;1>a&&(a=16);for(var c="",e=[],f=new Uint8Array(this.array),g=0;g<this.array.byteLength;g++){0<g&&0==g%a&&(e.push(c),c="");var h=f[g],h=32<h&&127>h?String.fromCharCode(h):".",c=c+h}e.push(c);return b?e:e.join("\n")+"\n"};
n.prototype.toString=function(){return this.array==k?"ByteBuffer(DESTROYED)":"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")"};n.prototype.toArrayBuffer=function(a){var b=this.clone();b.offset>b.length&&b.flip();var c=!1;if(0<b.offset||b.length<b.array.byteLength)b.compact(),c=j;return a&&!c?b.copy().array:b.array};
n.decodeUTF8Char=function(a,b){var c=a.readUint8(b),e,f,g,h,p,q=b;0==(c&128)?(e=c,b+=1):192==(c&224)?(e=a.readUint8(b+1),e=(c&31)<<6|e&63,b+=2):224==(c&240)?(e=a.readUint8(b+1),f=a.readUint8(b+2),e=(c&15)<<12|(e&63)<<6|f&63,b+=3):240==(c&248)?(e=a.readUint8(b+1),f=a.readUint8(b+2),g=a.readUint8(b+3),e=(c&7)<<18|(e&63)<<12|(f&63)<<6|g&63,b+=4):248==(c&252)?(e=a.readUint8(b+1),f=a.readUint8(b+2),g=a.readUint8(b+3),h=a.readUint8(b+4),e=(c&3)<<24|(e&63)<<18|(f&63)<<12|(g&63)<<6|h&63,b+=5):252==(c&254)?
(e=a.readUint8(b+1),f=a.readUint8(b+2),g=a.readUint8(b+3),h=a.readUint8(b+4),p=a.readUint8(b+5),e=(c&1)<<30|(e&63)<<24|(f&63)<<18|(g&63)<<12|(h&63)<<6|p&63,b+=6):d("Cannot decode UTF8 character at offset "+b+": charCode (0x"+c.toString(16)+") is invalid");return{"char":e,length:b-q}};
n.encodeUTF8Char=function(a,b,c){var e=c;0>a&&d("Cannot encode UTF8 character: charCode ("+a+") is negative");128>a?(b.writeUint8(a&127,c),c+=1):2048>a?(b.writeUint8(a>>6&31|192,c).writeUint8(a&63|128,c+1),c+=2):65536>a?(b.writeUint8(a>>12&15|224,c).writeUint8(a>>6&63|128,c+1).writeUint8(a&63|128,c+2),c+=3):2097152>a?(b.writeUint8(a>>18&7|240,c).writeUint8(a>>12&63|128,c+1).writeUint8(a>>6&63|128,c+2).writeUint8(a&63|128,c+3),c+=4):67108864>a?(b.writeUint8(a>>24&3|248,c).writeUint8(a>>18&63|128,c+
1).writeUint8(a>>12&63|128,c+2).writeUint8(a>>6&63|128,c+3).writeUint8(a&63|128,c+4),c+=5):2147483648>a?(b.writeUint8(a>>30&1|252,c).writeUint8(a>>24&63|128,c+1).writeUint8(a>>18&63|128,c+2).writeUint8(a>>12&63|128,c+3).writeUint8(a>>6&63|128,c+4).writeUint8(a&63|128,c+5),c+=6):d("Cannot encode UTF8 character: charCode (0x"+a.toString(16)+") is too large (>= 0x80000000)");return c-e};
n.calculateUTF8Char=function(a){0>a&&d("Cannot calculate length of UTF8 character: charCode ("+a+") is negative");if(128>a)return 1;if(2048>a)return 2;if(65536>a)return 3;if(2097152>a)return 4;if(67108864>a)return 5;if(2147483648>a)return 6;d("Cannot calculate length of UTF8 character: charCode (0x"+a.toString(16)+") is too large (>= 0x80000000)")};n.extend=function(a,b){"string"==typeof a&&"function"==typeof b?n.prototype[a]=b:d("Cannot extend prototype with "+a+"="+b+" (exptected string and function)")};
"undefined"!=typeof module&&module.exports?module.exports=n:"undefined"!=typeof define&&define.amd?define("ByteBuffer",[],function(){return n}):(this.dcodeIO||(this.dcodeIO={}),this.dcodeIO.ByteBuffer=n);

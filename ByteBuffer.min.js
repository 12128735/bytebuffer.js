/**
 * ByteBuffer.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/ByteBuffer.js for details
 */
var dcodeIO=typeof dcodeIO!="undefined"?dcodeIO:{};dcodeIO.ByteBuffer=function(e,t){e=typeof e!="undefined"?parseInt(e,10):dcodeIO.ByteBuffer.DEFAULT_CAPACITY;if(e<1)e=dcodeIO.ByteBuffer.DEFAULT_CAPACITY;this.array=arguments.length==3&&arguments[2]===true?null:new ArrayBuffer(e);this.view=this.array!=null?new DataView(this.array):null;this.offset=0;this.length=0;this.littleEndian=typeof t!="undefined"?!!t:false};dcodeIO.ByteBuffer.DEFAULT_CAPACITY=32;dcodeIO.ByteBuffer.LITTLE_ENDIAN=true;dcodeIO.ByteBuffer.BIG_ENDIAN=false;dcodeIO.ByteBuffer.allocate=function(e,t){return new dcodeIO.ByteBuffer(e,t)};dcodeIO.ByteBuffer.wrap=function(e,t){if(!!e["array"]){e=e["array"]}else if(!!e["buffer"]){e=e["buffer"]}if(!(e instanceof ArrayBuffer)){throw"Cannot wrap buffer of type "+typeof e}var n=new dcodeIO.ByteBuffer(0,t,true);n.array=e;n.view=new DataView(n.array);n.offset=0;n.length=e.byteLength;return n};dcodeIO.ByteBuffer.prototype.resize=function(e){if(this.array==null&&e>0){this.array=new ArrayBuffer(e);this.view=new DataView(this.array)}if(this.array.byteLength<e){var t=this.array;var n=new Uint8Array(t);var r=new ArrayBuffer(e);var i=new Uint8Array(r);i.set(n);this.array=r;this.view=new DataView(r);return true}return false};dcodeIO.ByteBuffer.prototype.slice=function(e,t){if(this.array==null){throw this+" cannot be sliced: Already destroyed"}if(t<=e){throw this+" cannot be sliced: End ("+t+") is less than begin ("+e+")"}if(e<0||e>this.array.byteLength||t<1||t>this.array.byteLength){throw this+" cannot be sliced: Index out of bounds (0-"+this.array.byteLength+" -> "+e+"-"+t+")"}var n=this.clone();n.offset=e;n.length=t;return n};dcodeIO.ByteBuffer.prototype.sliceAndCompact=function(e,t){return dcodeIO.ByteBuffer.wrap(this.slice(e,t).toArrayBuffer(true))};dcodeIO.ByteBuffer.prototype.ensureCapacity=function(e){if(this.array==null){return this.resize(e)}if(this.array.byteLength<e)return this.resize(this.array.byteLength*2>=e?this.array.byteLength*2:e);return false};dcodeIO.ByteBuffer.prototype.flip=function(){if(this.array==null){throw this+" cannot be flipped: Already destroyed"}this.length=this.offset;this.offset=0;return this};dcodeIO.ByteBuffer.prototype.reset=function(){this.offset=0;this.length=0;return this};dcodeIO.ByteBuffer.prototype.clone=function(){var e=new dcodeIO.ByteBuffer(-1,this.littleEndian,true);e.array=this.array;e.view=this.view;e.offset=this.offset;e.length=this.length;return e};dcodeIO.ByteBuffer.prototype.copy=function(){var e=new dcodeIO.ByteBuffer(this.array.byteLength,this.littleEndian);var t=new Uint8Array(this.array);var n=new Uint8Array(e.array);n.set(t);e.offset=this.offset;e.length=this.length;return e};dcodeIO.ByteBuffer.prototype.compact=function(){if(this.array==null){throw this+" cannot be compacted: Already destroyed"}if(this.offset>this.length){this.flip()}if(this.offset==this.length){throw this+" cannot be compacted: Offset ("+this.offset+") is equal to its length ("+this.length+")"}if(this.offset==0&&this.length==this.array.byteLength){return this}var e=new Uint8Array(this.array);var t=new ArrayBuffer(this.length-this.offset);var n=new Uint8Array(t);n.set(e.subarray(this.offset,this.length));this.array=t;this.offset=0;this.length=this.array.byteLength;return this};dcodeIO.ByteBuffer.prototype.destroy=function(){if(this.array==null)return;this.array=null;this.view=null;this.offset=0;this.length=0};dcodeIO.ByteBuffer.prototype.writeInt8=function(e,t){t=typeof t!="undefined"?t:(this.offset+=1)-1;this.ensureCapacity(t+1);this.view.setInt8(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readInt8=function(e){e=typeof e!="undefined"?e:(this.offset+=1)-1;return this.view.getInt8(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeByte=dcodeIO.ByteBuffer.prototype.writeInt8;dcodeIO.ByteBuffer.prototype.readByte=dcodeIO.ByteBuffer.prototype.readInt8;dcodeIO.ByteBuffer.prototype.writeUint8=function(e,t){t=typeof t!="undefined"?t:(this.offset+=1)-1;this.ensureCapacity(t+1);this.view.setUint8(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readUint8=function(e){e=typeof e!="undefined"?e:(this.offset+=1)-1;return this.view.getUint8(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeInt16=function(e,t){t=typeof t!="undefined"?t:(this.offset+=2)-2;this.ensureCapacity(t+2);this.view.setInt16(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readInt16=function(e){e=typeof e!="undefined"?e:(this.offset+=2)-2;return this.view.getInt16(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeShort=dcodeIO.ByteBuffer.prototype.writeInt16;dcodeIO.ByteBuffer.prototype.readShort=dcodeIO.ByteBuffer.prototype.readInt16;dcodeIO.ByteBuffer.prototype.writeUint16=function(e,t){t=typeof t!="undefined"?t:(this.offset+=2)-2;this.ensureCapacity(t+2);this.view.setUint16(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readUint16=function(e){e=typeof e!="undefined"?e:(this.offset+=2)-2;return this.view.getUint16(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeInt32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setInt32(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readInt32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getInt32(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeInt=dcodeIO.ByteBuffer.prototype.writeInt32;dcodeIO.ByteBuffer.prototype.readInt=dcodeIO.ByteBuffer.prototype.readInt32;dcodeIO.ByteBuffer.prototype.writeUint32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setUint32(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readUint32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getUint32(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeFloat32=function(e,t){t=typeof t!="undefined"?t:(this.offset+=4)-4;this.ensureCapacity(t+4);this.view.setFloat32(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readFloat32=function(e){e=typeof e!="undefined"?e:(this.offset+=4)-4;return this.view.getFloat32(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeFloat=dcodeIO.ByteBuffer.prototype.writeFloat32;dcodeIO.ByteBuffer.prototype.readFloat=dcodeIO.ByteBuffer.prototype.readFloat32;dcodeIO.ByteBuffer.prototype.writeFloat64=function(e,t){t=typeof t!="undefined"?t:(this.offset+=8)-8;this.ensureCapacity(t+8);this.view.setFloat64(t,e,this.littleEndian);return this};dcodeIO.ByteBuffer.prototype.readFloat64=function(e){e=typeof e!="undefined"?e:(this.offset+=8)-8;return this.view.getFloat64(e,this.littleEndian)};dcodeIO.ByteBuffer.prototype.writeDouble=dcodeIO.ByteBuffer.prototype.writeFloat64;dcodeIO.ByteBuffer.prototype.readDouble=dcodeIO.ByteBuffer.prototype.readFloat64;dcodeIO.ByteBuffer.prototype.writeUTF8String=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;var r=t;var i=0,s;for(s=0;s<e.length;s++){i+=dcodeIO.ByteBuffer.calculateUTF8Char(e.charCodeAt(s))}this.ensureCapacity(t+i);for(s=0;s<e.length;s++){t+=dcodeIO.ByteBuffer.encodeUTF8Char(e.charCodeAt(s),this,t)}if(n){this.offset=t;return this}else{return t-r}};dcodeIO.ByteBuffer.prototype.readUTF8String=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;var r,i="",s=t;for(var o=0;o<e;o++){r=dcodeIO.ByteBuffer.decodeUTF8Char(this,t);t+=r["length"];i+=String.fromCharCode(r["char"])}if(n){this.offset=t;return i}else{return{string:i,length:t-s}}};dcodeIO.ByteBuffer.prototype.writeLString=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;var r=dcodeIO.ByteBuffer.encodeUTF8Char(e.length,this,t);r+=this.writeUTF8String(e,t+r);if(n){this.offset+=r;return this}else{return r}};dcodeIO.ByteBuffer.prototype.readLString=function(e){var t=typeof e=="undefined";e=typeof e!="undefined"?e:this.offset;var n=dcodeIO.ByteBuffer.decodeUTF8Char(this,e);var r=this.readUTF8String(n["char"],e+n["length"]);if(t){this.offset+=n["length"]+r["length"];return r["string"]}else{return{string:r["string"],length:n["length"]+r["length"]}}};dcodeIO.ByteBuffer.prototype.writeCString=function(e,t){var n=typeof t=="undefined";t=typeof t!="undefined"?t:this.offset;var r=this.writeUTF8String(e,t);this.writeUint8(0,t+r);if(n){this.offset+=r+1;return this}else{return r+1}};dcodeIO.ByteBuffer.prototype.readCString=function(e){var t=typeof e=="undefined";e=typeof e!="undefined"?e:this.offset;var n,r="",i=e;do{n=dcodeIO.ByteBuffer.decodeUTF8Char(this,e);e+=n["length"];if(n["char"]!=0)r+=String.fromCharCode(n["char"])}while(n["char"]!=0);if(t){this.offset=e;return r}else{return{string:r,length:e-i}}};dcodeIO.ByteBuffer.prototype.writeJSON=function(e,t,n){n=n||JSON.stringify.bind(JSON);return this.writeLString(n(e),t)};dcodeIO.ByteBuffer.prototype.readJSON=function(e,t){t=t||JSON.parse.bind(JSON);var n=this.readLString(e);if(typeof n=="string"){return t(n)}else{return{data:t(n["string"]),length:n["length"]}}};dcodeIO.ByteBuffer.LINE="--------------------------------------------------";dcodeIO.ByteBuffer.prototype.printDebug=function(){console.log(this.toString()+"\n"+dcodeIO.ByteBuffer.LINE);console.log(this.toHex()+"\n")};dcodeIO.ByteBuffer.prototype.toHex=function(e){if(this.array==null)return"DESTROYED";e=typeof e!="undefined"?parseInt(e,10):16;if(e<1)e=16;var t="",n=new Uint8Array(this.array);for(var r=0;r<this.array.byteLength;r++){var i=n[r];i=i.toString(16).toUpperCase();if(i.length<2)i="0"+i;if(r>0&&r%e==0){t+="\n"}if(r==this.offset&&r==this.length){t+="|"}else if(r==this.offset){t+="<"}else if(r==this.length){t+=">"}else{t+=" "}t+=i}if(this.offset==this.array.byteLength&&this.length==this.array.byteLength){t+="|"}else if(this.length==this.array.byteLength){t+=">"}else if(this.offset==this.array.byteLength){t+="<"}return t};dcodeIO.ByteBuffer.prototype.toString=function(){if(this.array==null){return"ByteBuffer(DESTROYED)"}return"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")"};dcodeIO.ByteBuffer.prototype.toArrayBuffer=function(e){var t=this.clone();if(t.offset>t.length){t.flip()}var n=false;if(t.offset>0||t.length<t.array.byteLength){t.compact();n=true}return e&&!n?t.copy().array:t.array};dcodeIO.ByteBuffer.decodeUTF8Char=function(e,t){var n=e.readUint8(t),r,i,s,o,u,a=t,f;if((n&128)==0){f=n;t+=1}else if((n&224)==192){r=e.readUint8(t+1);f=(n&31)<<6|r&63;t+=2}else if((n&240)==224){r=e.readUint8(t+1);i=e.readUint8(t+2);f=(n&15)<<12|(r&63)<<6|i&63;t+=3}else if((n&248)==240){r=e.readUint8(t+1);i=e.readUint8(t+2);s=e.readUint8(t+3);f=(n&7)<<18|(r&63)<<12|(i&63)<<6|s&63;t+=4}else if((n&252)==248){r=e.readUint8(t+1);i=e.readUint8(t+2);s=e.readUint8(t+3);o=e.readUint8(t+4);f=(n&3)<<24|(r&63)<<18|(i&63)<<12|(s&63)<<6|o&63;t+=5}else if((n&254)==252){r=e.readUint8(t+1);i=e.readUint8(t+2);s=e.readUint8(t+3);o=e.readUint8(t+4);u=e.readUint8(t+5);f=(n&1)<<30|(r&63)<<24|(i&63)<<18|(s&63)<<12|(o&63)<<6|u&63;t+=6}else{throw"Invalid byte at offset "+t+": 0x"+n.toString(16)}return{"char":f,length:t-a}};dcodeIO.ByteBuffer.encodeUTF8Char=function(e,t,n){var r=n;if(e<0){throw"Cannot encode character with negative charCode ("+e+")"}if(e<128){t.writeUint8(e&127,n);n+=1}else if(e<2048){t.writeUint8(e>>6&31|192,n).writeUint8(e&63|128,n+1);n+=2}else if(e<65536){t.writeUint8(e>>12&15|224,n).writeUint8(e>>6&63|128,n+1).writeUint8(e&63|128,n+2);n+=3}else if(e<2097152){t.writeUint8(e>>18&7|240,n).writeUint8(e>>12&63|128,n+1).writeUint8(e>>6&63|128,n+2).writeUint8(e&63|128,n+3);n+=4}else if(e<67108864){t.writeUint8(e>>24&3|248,n).writeUint8(e>>18&63|128,n+1).writeUint8(e>>12&63|128,n+2).writeUint8(e>>6&63|128,n+3).writeUint8(e&63|128,n+4);n+=5}else{t.writeUint8(e>>30&1|252,n).writeUint8(e>>24&63|128,n+1).writeUint8(e>>18&63|128,n+2).writeUint8(e>>12&63|128,n+3).writeUint8(e>>6&63|128,n+4).writeUint8(e&63|128,n+5);n+=6}return n-r};dcodeIO.ByteBuffer.calculateUTF8Char=function(e){if(e<0){throw"Cannot calculate length of character with negative charCode ("+e+")"}if(e<128){return 1}else if(e<2048){return 2}else if(e<65536){return 3}else if(e<2097152){return 4}else if(e<67108864){return 5}else{return 6}};if(typeof module!="undefined"&&module["exports"]){module["exports"]=dcodeIO.ByteBuffer}else if(typeof require!="undefined"&&typeof define!="undefined"){define([],function(){return dcodeIO.ByteBuffer})}

/*
 ByteBuffer.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ByteBuffer.js for details
*/
function h(n){throw n;}var k=!0,m=null,p=!1;
(function(n){function b(a,c){a="undefined"!=typeof a?parseInt(a,10):b.DEFAULT_CAPACITY;1>a&&(a=b.DEFAULT_CAPACITY);this.array=3==arguments.length&&arguments[2]===k?m:new ArrayBuffer(a);this.view=this.array!=m?new DataView(this.array):m;this.length=this.offset=0;this.littleEndian="undefined"!=typeof c?!!c:p}b.DEFAULT_CAPACITY=16;b.LITTLE_ENDIAN=k;b.BIG_ENDIAN=p;b.INT8=new Int8Array(1);b.UINT8=new Uint8Array(1);b.INT16=new Int16Array(1);b.UINT16=new Uint16Array(1);b.INT32=new Int32Array(1);b.UINT32=
new Uint32Array(1);b.FLOAT32=new Float32Array(1);b.FLOAT64=new Float64Array(1);b.cast=function(a,c){a[0]=c;return a[0]};b.allocate=function(a,c){return new b(a,c)};b.wrap=function(a,c){if("string"==typeof a)return(new b).writeUTF8String(a).flip();a.array?a=a.array:a.buffer&&(a=a.buffer);a instanceof ArrayBuffer||h(Error("Cannot wrap buffer of type "+typeof a));var d=new b(0,c,k);d.array=a;d.view=new DataView(d.array);d.offset=0;d.length=a.byteLength;return d};b.prototype.LE=function(){this.littleEndian=
k;return this};b.prototype.BE=function(){this.littleEndian=p;return this};b.prototype.resize=function(a){if(1>a)return p;this.array==m&&(this.array=new ArrayBuffer(a),this.view=new DataView(this.array));if(this.array.byteLength<a){var c=new Uint8Array(this.array);a=new ArrayBuffer(a);(new Uint8Array(a)).set(c);this.array=a;this.view=new DataView(a);return k}return p};b.prototype.slice=function(a,c){this.array==m&&h(Error(this+" cannot be sliced: Already destroyed"));c<=a&&h(Error(this+" cannot be sliced: End ("+
c+") is less than begin ("+a+")"));(0>a||a>this.array.byteLength||1>c||c>this.array.byteLength)&&h(Error(this+" cannot be sliced: Index out of bounds (0-"+this.array.byteLength+" -> "+a+"-"+c+")"));var d=this.clone();d.offset=a;d.length=c;return d};b.prototype.sliceAndCompact=function(a,c){return b.wrap(this.slice(a,c).toArrayBuffer(k))};b.prototype.ensureCapacity=function(a){return this.array==m?this.resize(a):this.array.byteLength<a?this.resize(2*this.array.byteLength>=a?2*this.array.byteLength:
a):p};b.prototype.flip=function(){this.length=this.array==m?0:this.offset;this.offset=0;return this};b.prototype.reset=function(){this.length=this.offset=0;return this};b.prototype.clone=function(){var a=new b(-1,this.littleEndian,k);a.array=this.array;a.view=this.view;a.offset=this.offset;a.length=this.length;return a};b.prototype.copy=function(){if(this.array==m)return this.clone();var a=new b(this.array.byteLength,this.littleEndian),c=new Uint8Array(this.array);(new Uint8Array(a.array)).set(c);
a.offset=this.offset;a.length=this.length;return a};b.prototype.remaining=function(){return this.array==m?0:this.length-this.offset};b.prototype.capacity=function(){return this.array!=m?this.array.byteLength:0};b.prototype.compact=function(){this.array==m&&h(Error(this+" cannot be compacted: Already destroyed"));this.offset>this.length&&this.flip();this.offset==this.length&&h(Error(this+" cannot be compacted: Offset ("+this.offset+") is equal to its length ("+this.length+")"));if(0==this.offset&&
this.length==this.array.byteLength)return this;var a=new Uint8Array(this.array),c=new ArrayBuffer(this.length-this.offset);(new Uint8Array(c)).set(a.subarray(this.offset,this.length));this.array=c;this.offset=0;this.length=this.array.byteLength;return this};b.prototype.destroy=function(){if(this.array!=m)return this.view=this.array=m,this.length=this.offset=0,this};b.prototype.reverse=function(){this.array==m&&h(Error(this+" cannot be reversed: Already destroyed"));Array.prototype.reverse.call(new Uint8Array(this.array));
var a=this.offset;this.offset=this.array.byteLength-this.length;this.length=this.array.byteLength-a;return this};b.prototype.append=function(a,c){a instanceof b||(a=b.wrap(a));a.array==m&&h(Error(a+" cannot be appended to "+this+": Already destroyed"));var d=a.length-a.offset;if(0==d)return this;0>d&&(a=a.clone().flip(),d=a.length-a.offset);c="undefined"!=typeof c?c:(this.offset+=d)-d;this.ensureCapacity(c+d);d=new Uint8Array(a.array);(new Uint8Array(this.array)).set(d.subarray(a.offset,a.length),
c);return this};b.prototype.prepend=function(a,c){a instanceof b||(a=b.wrap(a));a.array==m&&h(a+" cannot be prepended to "+this+": Already destroyed");var d=a.length-a.offset;if(0==d)return this;0>d&&(a=a.clone().flip(),d=a.length-a.offset);var e="undefined"==typeof c;c="undefined"!=typeof c?c:this.offset;var f=d-c;0<f?(this.ensureCapacity(this.length+f),this.append(this,d),this.offset+=f,this.length+=f,this.append(a,0)):this.append(a,c-d);e&&(this.offset-=d);return this};b.prototype.writeInt8=function(a,
c){c="undefined"!=typeof c?c:(this.offset+=1)-1;this.ensureCapacity(c+1);this.view.setInt8(c,a);return this};b.prototype.readInt8=function(a){a="undefined"!=typeof a?a:(this.offset+=1)-1;a>=this.array.byteLength&&h(Error("Cannot read int8 from "+this+": Capacity overflow"));return this.view.getInt8(a)};b.prototype.writeByte=b.prototype.writeInt8;b.prototype.readByte=b.prototype.readInt8;b.prototype.writeUint8=function(a,c){c="undefined"!=typeof c?c:(this.offset+=1)-1;this.ensureCapacity(c+1);this.view.setUint8(c,
a);return this};b.prototype.readUint8=function(a){a="undefined"!=typeof a?a:(this.offset+=1)-1;a>=this.array.byteLength&&h("Cannot read uint8 from "+this+": Capacity overflow");return this.view.getUint8(a)};b.prototype.writeInt16=function(a,c){c="undefined"!=typeof c?c:(this.offset+=2)-2;this.ensureCapacity(c+2);this.view.setInt16(c,a,this.littleEndian);return this};b.prototype.readInt16=function(a){a="undefined"!=typeof a?a:(this.offset+=2)-2;a+2>this.array.byteLength&&h(Error("Cannot read int16 from "+
this+": Capacity overflow"));return this.view.getInt16(a,this.littleEndian)};b.prototype.writeShort=b.prototype.writeInt16;b.prototype.readShort=b.prototype.readInt16;b.prototype.writeUint16=function(a,c){c="undefined"!=typeof c?c:(this.offset+=2)-2;this.ensureCapacity(c+2);this.view.setUint16(c,a,this.littleEndian);return this};b.prototype.readUint16=function(a){a="undefined"!=typeof a?a:(this.offset+=2)-2;a+2>this.array.c&&h(Error("Cannot read int16 from "+this+": Capacity overflow"));return this.view.getUint16(a,
this.littleEndian)};b.prototype.writeInt32=function(a,c){c="undefined"!=typeof c?c:(this.offset+=4)-4;this.ensureCapacity(c+4);this.view.setInt32(c,a,this.littleEndian);return this};b.prototype.readInt32=function(a){a="undefined"!=typeof a?a:(this.offset+=4)-4;a+4>this.array.byteLength&&h(Error("Cannot read int32 from "+this+": Capacity overflow"));return this.view.getInt32(a,this.littleEndian)};b.prototype.writeInt=b.prototype.writeInt32;b.prototype.readInt=b.prototype.readInt32;b.prototype.writeUint32=
function(a,c){c="undefined"!=typeof c?c:(this.offset+=4)-4;this.ensureCapacity(c+4);this.view.setUint32(c,a,this.littleEndian);return this};b.prototype.readUint32=function(a){a="undefined"!=typeof a?a:(this.offset+=4)-4;a+4>this.array.byteLength&&h(Error("Cannot read uint32 from "+this+": Capacity overflow"));return this.view.getUint32(a,this.littleEndian)};b.prototype.writeFloat32=function(a,c){c="undefined"!=typeof c?c:(this.offset+=4)-4;this.ensureCapacity(c+4);this.view.setFloat32(c,a,this.littleEndian);
return this};b.prototype.readFloat32=function(a){a="undefined"!=typeof a?a:(this.offset+=4)-4;(this.array==m||a+4>this.array.byteLength)&&h(Error("Cannot read float32 from "+this+": Capacity overflow"));return this.view.getFloat32(a,this.littleEndian)};b.prototype.writeFloat=b.prototype.writeFloat32;b.prototype.readFloat=b.prototype.readFloat32;b.prototype.writeFloat64=function(a,c){c="undefined"!=typeof c?c:(this.offset+=8)-8;this.ensureCapacity(c+8);this.view.setFloat64(c,a,this.littleEndian);return this};
b.prototype.readFloat64=function(a){a="undefined"!=typeof a?a:(this.offset+=8)-8;(this.array==m||a+8>this.array.byteLength)&&h(Error("Cannot read float64 from "+this+": Capacity overflow"));return this.view.getFloat64(a,this.littleEndian)};b.prototype.writeDouble=b.prototype.writeFloat64;b.prototype.readDouble=b.prototype.readFloat64;b.prototype.writeLong=b.prototype.writeFloat64;b.prototype.readLong=function(a){return Math.round(this.readFloat64(a))};b.a=5;b.prototype.writeVarint32=function(a,c){var d=
"undefined"==typeof c;c="undefined"!=typeof c?c:this.offset;b.UINT32[0]=a;this.ensureCapacity(c+b.calculateVarint32(a=b.UINT32[0]));var e=new Uint8Array(this.array),f=0;e[c]=a|128;128<=a?(e[c+1]=a>>7|128,16384<=a?(e[c+2]=a>>14|128,2097152<=a?(e[c+3]=a>>21|128,268435456<=a?(e[c+4]=a>>28&127,f=5):(e[c+3]&=127,f=4)):(e[c+2]&=127,f=3)):(e[c+1]&=127,f=2)):(e[c]&=127,f=1);return d?(this.offset+=f,this):f};b.prototype.readVarint32=function(a){var c="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;
var d=new Uint8Array(this.array),e=0,f;b.UINT32[0]=0;do e==b.a&&h(Error("Cannot read Varint32 from "+this+"@"+a+": Number of bytes is larger than "+b.a)),f=d[a+e],b.UINT32[0]|=(f&127)<<7*e,++e;while(f&128);b.INT32[0]=b.UINT32[0];return c?(this.offset+=e,b.INT32[0]):{value:b.INT32[0],length:e}};b.prototype.writeZigZagVarint32=function(a,c){return this.writeVarint32(b.zigZagEncode32(a),c)};b.prototype.readZigZagVarint32=function(a){a=this.readVarint32(a);return"object"==typeof a?(a.value=b.zigZagDecode32(a.value),
a):b.zigZagDecode32(a)};b.prototype.writeVarint=b.prototype.writeVarint32;b.prototype.readVarint=b.prototype.readVarint32;b.calculateVarint32=function(a){b.UINT32[0]=a;return 128>b.UINT32[0]?1:16384>b.UINT32[0]?2:2097152>b.UINT32[0]?3:268435456>b.UINT32[0]?4:5};b.zigZagEncode32=function(a){b.INT32[0]=a;return 0<=(a=b.INT32[0])?2*a:2*-a-1};b.zigZagDecode32=function(a){b.UINT32[0]=a;return 0==((a=b.UINT32[0])&1)?a/2:-(a+1)/2};b.decodeUTF8Char=function(a,c){var d=a.readUint8(c),b,f,g,l,n,q=c;0==(d&128)?
(b=d,c+=1):192==(d&224)?(b=a.readUint8(c+1),b=(d&31)<<6|b&63,c+=2):224==(d&240)?(b=a.readUint8(c+1),f=a.readUint8(c+2),b=(d&15)<<12|(b&63)<<6|f&63,c+=3):240==(d&248)?(b=a.readUint8(c+1),f=a.readUint8(c+2),g=a.readUint8(c+3),b=(d&7)<<18|(b&63)<<12|(f&63)<<6|g&63,c+=4):248==(d&252)?(b=a.readUint8(c+1),f=a.readUint8(c+2),g=a.readUint8(c+3),l=a.readUint8(c+4),b=(d&3)<<24|(b&63)<<18|(f&63)<<12|(g&63)<<6|l&63,c+=5):252==(d&254)?(b=a.readUint8(c+1),f=a.readUint8(c+2),g=a.readUint8(c+3),l=a.readUint8(c+4),
n=a.readUint8(c+5),b=(d&1)<<30|(b&63)<<24|(f&63)<<18|(g&63)<<12|(l&63)<<6|n&63,c+=6):h(Error("Cannot decode UTF8 character at offset "+c+": charCode (0x"+d.toString(16)+") is invalid"));return{"char":b,length:c-q}};b.encodeUTF8Char=function(a,c,b){var e=b;0>a&&h(Error("Cannot encode UTF8 character: charCode ("+a+") is negative"));128>a?(c.writeUint8(a&127,b),b+=1):2048>a?(c.writeUint8(a>>6&31|192,b).writeUint8(a&63|128,b+1),b+=2):65536>a?(c.writeUint8(a>>12&15|224,b).writeUint8(a>>6&63|128,b+1).writeUint8(a&
63|128,b+2),b+=3):2097152>a?(c.writeUint8(a>>18&7|240,b).writeUint8(a>>12&63|128,b+1).writeUint8(a>>6&63|128,b+2).writeUint8(a&63|128,b+3),b+=4):67108864>a?(c.writeUint8(a>>24&3|248,b).writeUint8(a>>18&63|128,b+1).writeUint8(a>>12&63|128,b+2).writeUint8(a>>6&63|128,b+3).writeUint8(a&63|128,b+4),b+=5):2147483648>a?(c.writeUint8(a>>30&1|252,b).writeUint8(a>>24&63|128,b+1).writeUint8(a>>18&63|128,b+2).writeUint8(a>>12&63|128,b+3).writeUint8(a>>6&63|128,b+4).writeUint8(a&63|128,b+5),b+=6):h(Error("Cannot encode UTF8 character: charCode (0x"+
a.toString(16)+") is too large (>= 0x80000000)"));return b-e};b.calculateUTF8Char=function(a){0>a&&h(Error("Cannot calculate length of UTF8 character: charCode ("+a+") is negative"));if(128>a)return 1;if(2048>a)return 2;if(65536>a)return 3;if(2097152>a)return 4;if(67108864>a)return 5;if(2147483648>a)return 6;h(Error("Cannot calculate length of UTF8 character: charCode (0x"+a.toString(16)+") is too large (>= 0x80000000)"))};b.b=function(a){a=""+a;for(var c=0,d=0;d<a.length;d++)c+=b.calculateUTF8Char(a.charCodeAt(d));
return c};b.prototype.writeUTF8String=function(a,c){var d="undefined"==typeof c,e=c="undefined"!=typeof c?c:this.offset,f=b.b(a);this.ensureCapacity(c+f);for(f=0;f<a.length;f++)c+=b.encodeUTF8Char(a.charCodeAt(f),this,c);return d?(this.offset=c,this):c-e};b.prototype.readUTF8String=function(a,c){var d="undefined"==typeof c;c="undefined"!=typeof c?c:this.offset;for(var e,f="",g=c,l=0;l<a;l++)e=b.decodeUTF8Char(this,c),c+=e.length,f+=String.fromCharCode(e["char"]);return d?(this.offset=c,f):{string:f,
length:c-g}};b.prototype.readUTF8StringBytes=function(a,c){var d="undefined"==typeof c;c="undefined"!=typeof c?c:this.offset;var e,f="",g=c;for(a=c+a;c<a;)e=b.decodeUTF8Char(this,c),c+=e.length,f+=String.fromCharCode(e["char"]);c!=a&&h(Error("Actual string length differs from the specified: "+((c>a?"+":"")+c-a)+" bytes"));return d?(this.offset=c,f):{string:f,length:c-g}};b.prototype.writeLString=function(a,c){a=""+a;var d="undefined"==typeof c;c="undefined"!=typeof c?c:this.offset;var e=b.encodeUTF8Char(a.length,
this,c),e=e+this.writeUTF8String(a,c+e);return d?(this.offset+=e,this):e};b.prototype.readLString=function(a){var c="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;var d=b.decodeUTF8Char(this,a);a=this.readUTF8String(d["char"],a+d.length);return c?(this.offset+=d.length+a.length,a.string):{string:a.string,length:d.length+a.length}};b.prototype.writeVString=function(a,c){a=""+a;var d="undefined"==typeof c;c="undefined"!=typeof c?c:this.offset;var e=this.writeVarint32(b.b(a),c),e=e+this.writeUTF8String(a,
c+e);return d?(this.offset+=e,this):e};b.prototype.readVString=function(a){var c="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;var b=this.readVarint32(a);a=this.readUTF8StringBytes(b.value,a+b.length);return c?(this.offset+=b.length+a.length,a.string):{string:a.string,length:b.length+a.length}};b.prototype.writeCString=function(a,c){var b="undefined"==typeof c;c="undefined"!=typeof c?c:this.offset;var e=this.writeUTF8String(""+a,c);this.writeUint8(0,c+e);return b?(this.offset+=e+1,this):
e+1};b.prototype.readCString=function(a){var c="undefined"==typeof a;a="undefined"!=typeof a?a:this.offset;var d,e="",f=a;do d=b.decodeUTF8Char(this,a),a+=d.length,0!=d["char"]&&(e+=String.fromCharCode(d["char"]));while(0!=d["char"]);return c?(this.offset=a,e):{string:e,length:a-f}};b.prototype.writeJSON=function(a,c,b){b="function"==typeof b?b:JSON.stringify;return this.writeLString(b(a),c)};b.prototype.readJSON=function(a,c){c="function"==typeof c?c:JSON.parse;var b=this.readLString(a);return"string"==
typeof b?c(b):{data:c(b.string),length:b.length}};b.prototype.printDebug=function(a){for(var c=(this.array!=m?"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")":"ByteBuffer(DESTROYED)")+"\n-------------------------------------------------------------------\n",b=this.toHex(16,k),e=this.toASCII(16,k),f=0;f<b.length;f++)c+=b[f]+"  "+e[f]+"\n";if(a===k)return c;"function"==typeof a?a(c):console.log(c)};b.prototype.toHex=function(a,c){if(this.array==m)return"DESTROYED";
c=!!c;a="undefined"!=typeof a?parseInt(a,10):16;1>a&&(a=16);for(var b="",e=[],f=new Uint8Array(this.array),b=0==this.offset&&0==this.length?b+"|":0==this.length?b+">":0==this.offset?b+"<":b+" ",g=0;g<this.array.byteLength;g++){0<g&&0==g%a&&(e.push(b),b=" ");var l=f[g],l=l.toString(16).toUpperCase();2>l.length&&(l="0"+l);b+=l;b=g+1==this.offset&&g+1==this.length?b+"|":g+1==this.offset?b+"<":g+1==this.length?b+">":b+" "}if(c)for(;b.length<3*a+1;)b+="   ";e.push(b);return c?e:e.join("\n")};b.prototype.toASCII=
function(a,c){if(this.array==m)return"";c=!!c;a="undefined"!=typeof a?parseInt(a,10):16;1>a&&(a=16);for(var b="",e=[],f=new Uint8Array(this.array),g=0;g<this.array.byteLength;g++){0<g&&0==g%a&&(e.push(b),b="");var l=f[g],l=32<l&&127>l?String.fromCharCode(l):".",b=b+l}e.push(b);return c?e:e.join("\n")+"\n"};b.prototype.toString=function(){return this.array==m?"ByteBuffer(DESTROYED)":"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")"};b.prototype.toArrayBuffer=
function(a){var c=this.clone();c.offset>c.length&&c.flip();var b=p;if(0<c.offset||c.length<c.array.byteLength)c.compact(),b=k;return a&&!b?c.copy().array:c.array};b.extend=function(a,c){"string"==typeof a&&"function"==typeof c?b.prototype[a]=c:h(Error("Cannot extend prototype with "+a+"="+c+" (exptected string and function)"))};"undefined"!=typeof module&&module.exports?module.exports=b:"undefined"!=typeof define&&define.amd?define("ByteBuffer",[],function(){return b}):(n.dcodeIO||(n.dcodeIO={}),
n.dcodeIO.ByteBuffer=b)})(this);

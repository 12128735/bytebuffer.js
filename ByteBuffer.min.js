/**
 * @license ByteBuffer.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/ByteBuffer.js for details
 */
(function(window){"use strict";var ByteBuffer=function(capacity,littleEndian){capacity=typeof capacity!="undefined"?parseInt(capacity,10):ByteBuffer.DEFAULT_CAPACITY;if(capacity<1)capacity=ByteBuffer.DEFAULT_CAPACITY;this.array=arguments.length==3&&arguments[2]===true?null:new ArrayBuffer(capacity);this.view=this.array!=null?new DataView(this.array):null;this.offset=0;this.length=0;this.littleEndian=typeof littleEndian!="undefined"?!!littleEndian:false};ByteBuffer.DEFAULT_CAPACITY=32;ByteBuffer.LITTLE_ENDIAN=true;ByteBuffer.BIG_ENDIAN=false;ByteBuffer.allocate=function(capacity,littleEndian){return new ByteBuffer(capacity,littleEndian)};ByteBuffer.wrap=function(buffer,littleEndian){if(!!buffer["array"]){buffer=buffer["array"]}else if(!!buffer["buffer"]){buffer=buffer["buffer"]}if(!(buffer instanceof ArrayBuffer)){throw"Cannot wrap buffer of type "+typeof buffer}var b=new ByteBuffer(0,littleEndian,true);b.array=buffer;b.view=new DataView(b.array);b.offset=0;b.length=buffer.byteLength;return b};ByteBuffer.prototype.resize=function(capacity){if(this.array==null&&capacity>0){this.array=new ArrayBuffer(capacity);this.view=new DataView(this.array)}if(this.array.byteLength<capacity){var src=this.array;var srcView=new Uint8Array(src);var dst=new ArrayBuffer(capacity);var dstView=new Uint8Array(dst);dstView.set(srcView);this.array=dst;this.view=new DataView(dst);return true}return false};ByteBuffer.prototype.slice=function(begin,end){if(this.array==null){throw this+" cannot be sliced: Already destroyed"}if(end<=begin){throw this+" cannot be sliced: End ("+end+") is less than begin ("+begin+")"}if(begin<0||begin>this.array.byteLength||end<1||end>this.array.byteLength){throw this+" cannot be sliced: Index out of bounds (0-"+this.array.byteLength+" -> "+begin+"-"+end+")"}var b=this.clone();b.offset=begin;b.length=end;return b};ByteBuffer.prototype.sliceAndCompact=function(begin,end){return ByteBuffer.wrap(this.slice(begin,end).toArrayBuffer(true))};ByteBuffer.prototype.ensureCapacity=function(capacity){if(this.array==null){return this.resize(capacity)}if(this.array.byteLength<capacity)return this.resize(this.array.byteLength*2>=capacity?this.array.byteLength*2:capacity);return false};ByteBuffer.prototype.flip=function(){if(this.array==null){throw this+" cannot be flipped: Already destroyed"}this.length=this.offset;this.offset=0;return this};ByteBuffer.prototype.reset=function(){this.offset=0;this.length=0;return this};ByteBuffer.prototype.clone=function(){var b=new ByteBuffer(-1,this.littleEndian,true);b.array=this.array;b.view=this.view;b.offset=this.offset;b.length=this.length;return b};ByteBuffer.prototype.copy=function(){var b=new ByteBuffer(this.array.byteLength,this.littleEndian);var src=new Uint8Array(this.array);var dst=new Uint8Array(b.array);dst.set(src);b.offset=this.offset;b.length=this.length;return b};ByteBuffer.prototype.remaining=function(){return this.length-this.offset};ByteBuffer.prototype.capacity=function(){return this.array!=null?this.array.byteLength:0};ByteBuffer.prototype.compact=function(){if(this.array==null){throw this+" cannot be compacted: Already destroyed"}if(this.offset>this.length){this.flip()}if(this.offset==this.length){throw this+" cannot be compacted: Offset ("+this.offset+") is equal to its length ("+this.length+")"}if(this.offset==0&&this.length==this.array.byteLength){return this}var srcView=new Uint8Array(this.array);var dst=new ArrayBuffer(this.length-this.offset);var dstView=new Uint8Array(dst);dstView.set(srcView.subarray(this.offset,this.length));this.array=dst;this.offset=0;this.length=this.array.byteLength;return this};ByteBuffer.prototype.destroy=function(){if(this.array==null)return;this.array=null;this.view=null;this.offset=0;this.length=0};ByteBuffer.prototype.reverse=function(){if(this.array==null){throw this+" cannot be reversed: Already destroyed"}Array.prototype.reverse.call(new Uint8Array(this.array));var o=this.offset;this.offset=this.array.byteLength-this.length;this.length=this.array.byteLength-o;return this};ByteBuffer.prototype.append=function(src,offset){if(src.array==null){throw src+" cannot be appended to "+this+": Already destroyed"}var n=src.length-src.offset;if(n==0)return this;if(n<0){src=src.clone().flip();n=src.length-src.offset}offset=typeof offset!="undefined"?offset:(this.length+=n)-n;this.ensureCapacity(offset+n);var srcView=new Uint8Array(src.array);var dstView=new Uint8Array(this.array);dstView.set(srcView.subarray(src.offset,src.length),offset);return this};ByteBuffer.prototype.prepend=function(src,offset){if(src.array==null){throw src+" cannot be prepended to "+this+": Already destroyed"}var n=src.length-src.offset;if(n==0)return this;if(n<0){src=src.clone().flip();n=src.length-src.offset}var modify=typeof offset=="undefined";offset=typeof offset!="undefined"?offset:this.offset;var diff=n-offset;if(diff>0){this.ensureCapacity(this.length+diff);this.append(this,n);this.offset+=diff;this.length+=diff;this.append(src,0)}else{this.append(src,offset-n)}if(modify){this.offset-=n}return this};ByteBuffer.prototype.writeInt8=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=1)-1;this.ensureCapacity(offset+1);this.view.setInt8(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readInt8=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=1)-1;return this.view.getInt8(offset,this.littleEndian)};ByteBuffer.prototype.writeByte=ByteBuffer.prototype.writeInt8;ByteBuffer.prototype.readByte=ByteBuffer.prototype.readInt8;ByteBuffer.prototype.writeUint8=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=1)-1;this.ensureCapacity(offset+1);this.view.setUint8(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readUint8=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=1)-1;return this.view.getUint8(offset,this.littleEndian)};ByteBuffer.prototype.writeInt16=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=2)-2;this.ensureCapacity(offset+2);this.view.setInt16(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readInt16=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=2)-2;return this.view.getInt16(offset,this.littleEndian)};ByteBuffer.prototype.writeShort=ByteBuffer.prototype.writeInt16;ByteBuffer.prototype.readShort=ByteBuffer.prototype.readInt16;ByteBuffer.prototype.writeUint16=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=2)-2;this.ensureCapacity(offset+2);this.view.setUint16(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readUint16=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=2)-2;return this.view.getUint16(offset,this.littleEndian)};ByteBuffer.prototype.writeInt32=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=4)-4;this.ensureCapacity(offset+4);this.view.setInt32(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readInt32=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=4)-4;return this.view.getInt32(offset,this.littleEndian)};ByteBuffer.prototype.writeInt=ByteBuffer.prototype.writeInt32;ByteBuffer.prototype.readInt=ByteBuffer.prototype.readInt32;ByteBuffer.prototype.writeUint32=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=4)-4;this.ensureCapacity(offset+4);this.view.setUint32(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readUint32=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=4)-4;return this.view.getUint32(offset,this.littleEndian)};ByteBuffer.prototype.writeFloat32=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=4)-4;this.ensureCapacity(offset+4);this.view.setFloat32(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readFloat32=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=4)-4;return this.view.getFloat32(offset,this.littleEndian)};ByteBuffer.prototype.writeFloat=ByteBuffer.prototype.writeFloat32;ByteBuffer.prototype.readFloat=ByteBuffer.prototype.readFloat32;ByteBuffer.prototype.writeFloat64=function(value,offset){offset=typeof offset!="undefined"?offset:(this.offset+=8)-8;this.ensureCapacity(offset+8);this.view.setFloat64(offset,value,this.littleEndian);return this};ByteBuffer.prototype.readFloat64=function(offset){offset=typeof offset!="undefined"?offset:(this.offset+=8)-8;return this.view.getFloat64(offset,this.littleEndian)};ByteBuffer.prototype.writeDouble=ByteBuffer.prototype.writeFloat64;ByteBuffer.prototype.readDouble=ByteBuffer.prototype.readFloat64;ByteBuffer.prototype.writeLong=ByteBuffer.prototype.writeFloat64;ByteBuffer.prototype.readLong=function(offset){return Math.round(this.readFloat64(offset))};ByteBuffer.prototype.writeUTF8String=function(str,offset){var advance=typeof offset=="undefined";offset=typeof offset!="undefined"?offset:this.offset;var start=offset;var encLen=0,i;for(i=0;i<str.length;i++){encLen+=ByteBuffer.calculateUTF8Char(str.charCodeAt(i))}this.ensureCapacity(offset+encLen);for(i=0;i<str.length;i++){offset+=ByteBuffer.encodeUTF8Char(str.charCodeAt(i),this,offset)}if(advance){this.offset=offset;return this}else{return offset-start}};ByteBuffer.prototype.readUTF8String=function(chars,offset){var advance=typeof offset=="undefined";offset=typeof offset!="undefined"?offset:this.offset;var dec,result="",start=offset;for(var i=0;i<chars;i++){dec=ByteBuffer.decodeUTF8Char(this,offset);offset+=dec["length"];result+=String.fromCharCode(dec["char"])}if(advance){this.offset=offset;return result}else{return{string:result,length:offset-start}}};ByteBuffer.prototype.writeLString=function(str,offset){var advance=typeof offset=="undefined";offset=typeof offset!="undefined"?offset:this.offset;var encLen=ByteBuffer.encodeUTF8Char(str.length,this,offset);encLen+=this.writeUTF8String(str,offset+encLen);if(advance){this.offset+=encLen;return this}else{return encLen}};ByteBuffer.prototype.readLString=function(offset){var advance=typeof offset=="undefined";offset=typeof offset!="undefined"?offset:this.offset;var lenDec=ByteBuffer.decodeUTF8Char(this,offset);var dec=this.readUTF8String(lenDec["char"],offset+lenDec["length"]);if(advance){this.offset+=lenDec["length"]+dec["length"];return dec["string"]}else{return{string:dec["string"],length:lenDec["length"]+dec["length"]}}};ByteBuffer.prototype.writeCString=function(str,offset){var advance=typeof offset=="undefined";offset=typeof offset!="undefined"?offset:this.offset;var encLen=this.writeUTF8String(str,offset);this.writeUint8(0,offset+encLen);if(advance){this.offset+=encLen+1;return this}else{return encLen+1}};ByteBuffer.prototype.readCString=function(offset){var advance=typeof offset=="undefined";offset=typeof offset!="undefined"?offset:this.offset;var dec,result="",start=offset;do{dec=ByteBuffer.decodeUTF8Char(this,offset);offset+=dec["length"];if(dec["char"]!=0)result+=String.fromCharCode(dec["char"])}while(dec["char"]!=0);if(advance){this.offset=offset;return result}else{return{string:result,length:offset-start}}};ByteBuffer.prototype.writeJSON=function(data,offset,stringify){stringify=stringify||JSON.stringify.bind(JSON);return this.writeLString(stringify(data),offset)};ByteBuffer.prototype.readJSON=function(offset,parse){parse=parse||JSON.parse.bind(JSON);var result=this.readLString(offset);if(typeof result=="string"){return parse(result)}else{return{data:parse(result["string"]),length:result["length"]}}};ByteBuffer.prototype.printDebug=function(){if(typeof console!="undefined"&&console["log"]){var s=this.toString()+"\n"+"-------------------------------------------------------------------\n";var h=this.toHex(16,true);var a=this.toASCII(16,true);for(var i=0;i<h.length;i++){s+=h[i]+"  "+a[i]+"\n"}console.log(s)}};ByteBuffer.prototype.toHex=function(wrap,asArray){if(this.array==null)return"DESTROYED";asArray=!!asArray;wrap=typeof wrap!="undefined"?parseInt(wrap,10):16;if(wrap<1)wrap=16;var out="",lines=[],view=new Uint8Array(this.array);if(this.offset==0&&this.length==0){out+="|"}else if(this.length==0){out+=">"}else if(this.offset==0){out+="<"}else{out+=" "}for(var i=0;i<this.array.byteLength;i++){if(i>0&&i%wrap==0){lines.push(out);out=" "}var val=view[i];val=val.toString(16).toUpperCase();if(val.length<2)val="0"+val;out+=val;if(i+1==this.offset&&i+1==this.length){out+="|"}else if(i+1==this.offset){out+="<"}else if(i+1==this.length){out+=">"}else{out+=" "}}if(asArray){while(out.length<3*wrap+1)out+="   "}lines.push(out);return asArray?lines:lines.join("\n")};ByteBuffer.prototype.toASCII=function(wrap,asArray){if(this.array==null)return"";asArray=!!asArray;wrap=typeof wrap!="undefined"?parseInt(wrap,10):16;if(wrap<1)wrap=16;var out="",lines=[],view=new Uint8Array(this.array);for(var i=0;i<this.array.byteLength;i++){if(i>0&&i%wrap==0){lines.push(out);out=""}var val=view[i];if(val>32&&val<127){val=String.fromCharCode(val)}else{val="."}out+=val}lines.push(out);return asArray?lines:lines.join("\n")+"\n"};ByteBuffer.prototype.toString=function(){if(this.array==null){return"ByteBuffer(DESTROYED)"}return"ByteBuffer(offset="+this.offset+",length="+this.length+",capacity="+this.array.byteLength+")"};ByteBuffer.prototype.toArrayBuffer=function(forceCopy){var b=this.clone();if(b.offset>b.length){b.flip()}var copied=false;if(b.offset>0||b.length<b.array.byteLength){b.compact();copied=true}return forceCopy&&!copied?b.copy().array:b.array};ByteBuffer.decodeUTF8Char=function(src,offset){var a=src.readUint8(offset),b,c,d,e,f,start=offset,charCode;if((a&128)==0){charCode=a;offset+=1}else if((a&224)==192){b=src.readUint8(offset+1);charCode=(a&31)<<6|b&63;offset+=2}else if((a&240)==224){b=src.readUint8(offset+1);c=src.readUint8(offset+2);charCode=(a&15)<<12|(b&63)<<6|c&63;offset+=3}else if((a&248)==240){b=src.readUint8(offset+1);c=src.readUint8(offset+2);d=src.readUint8(offset+3);charCode=(a&7)<<18|(b&63)<<12|(c&63)<<6|d&63;offset+=4}else if((a&252)==248){b=src.readUint8(offset+1);c=src.readUint8(offset+2);d=src.readUint8(offset+3);e=src.readUint8(offset+4);charCode=(a&3)<<24|(b&63)<<18|(c&63)<<12|(d&63)<<6|e&63;offset+=5}else if((a&254)==252){b=src.readUint8(offset+1);c=src.readUint8(offset+2);d=src.readUint8(offset+3);e=src.readUint8(offset+4);f=src.readUint8(offset+5);charCode=(a&1)<<30|(b&63)<<24|(c&63)<<18|(d&63)<<12|(e&63)<<6|f&63;offset+=6}else{throw"Cannot decode UTF8 character at offset "+offset+": charCode (0x"+a.toString(16)+") is invalid"}return{"char":charCode,length:offset-start}};ByteBuffer.encodeUTF8Char=function(charCode,dst,offset){var start=offset;if(charCode<0){throw"Cannot encode UTF8 character: charCode ("+charCode+") is negative"}if(charCode<128){dst.writeUint8(charCode&127,offset);offset+=1}else if(charCode<2048){dst.writeUint8(charCode>>6&31|192,offset).writeUint8(charCode&63|128,offset+1);offset+=2}else if(charCode<65536){dst.writeUint8(charCode>>12&15|224,offset).writeUint8(charCode>>6&63|128,offset+1).writeUint8(charCode&63|128,offset+2);offset+=3}else if(charCode<2097152){dst.writeUint8(charCode>>18&7|240,offset).writeUint8(charCode>>12&63|128,offset+1).writeUint8(charCode>>6&63|128,offset+2).writeUint8(charCode&63|128,offset+3);offset+=4}else if(charCode<67108864){dst.writeUint8(charCode>>24&3|248,offset).writeUint8(charCode>>18&63|128,offset+1).writeUint8(charCode>>12&63|128,offset+2).writeUint8(charCode>>6&63|128,offset+3).writeUint8(charCode&63|128,offset+4);offset+=5}else if(charCode<2147483648){dst.writeUint8(charCode>>30&1|252,offset).writeUint8(charCode>>24&63|128,offset+1).writeUint8(charCode>>18&63|128,offset+2).writeUint8(charCode>>12&63|128,offset+3).writeUint8(charCode>>6&63|128,offset+4).writeUint8(charCode&63|128,offset+5);offset+=6}else{throw"Cannot encode UTF8 character: charCode (0x"+charCode.toString(16)+") is too large (>= 0x80000000)"}return offset-start};ByteBuffer.calculateUTF8Char=function(charCode){if(charCode<0){throw"Cannot calculate length of UTF8 character: charCode ("+charCode+") is negative"}if(charCode<128){return 1}else if(charCode<2048){return 2}else if(charCode<65536){return 3}else if(charCode<2097152){return 4}else if(charCode<67108864){return 5}else if(charCode<2147483648){return 6}else{throw"Cannot calculate length of UTF8 character: charCode (0x"+charCode.toString(16)+") is too large (>= 0x80000000)"}};if(typeof module!="undefined"&&module["exports"]){module["exports"]=ByteBuffer}else if(typeof define!="undefined"&&define["amd"]){define([],function(){return ByteBuffer})}else{if(window){if(!window["dcodeIO"]){window["dcodeIO"]={}}window["dcodeIO"]["ByteBuffer"]=ByteBuffer}else{throw"Cannot load ByteBuffer.js: Neigher a CommonJS or AMD loader nor a global window is available"}}})(typeof window!="undefined"?window:null);